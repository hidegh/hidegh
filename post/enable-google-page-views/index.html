<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="-1">

        <title>Enable Google Page Views | Balazs&#39;s BLOG</title>
        <meta name="title" content="Enable Google Page Views | Balazs&#39;s BLOG">
        <meta name="description" content="Helping agencies &amp; SMEs to land easy to maintain projects and (remote) teams">
        <meta name="keywords" content="google analytics,pageviews,digitalization,business,management,agile,software,softwareengineering,softwarearchitecture,programming">
        <meta name="author" content="Dinesh Prasanth Moluguwan Krishnamoorthy">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://hidegh.github.io/post/enable-google-page-views/">
        <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png">
        
        <link rel="stylesheet" href="/assets/css/main.css" />

        <link rel="preconnect" href="cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="cdnjs.cloudflare.com">

        <link rel="preconnect" href="cdn.jsdelivr.net">
        <link rel="dns-prefetch" href="cdn.jsdelivr.net">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta2/js/bootstrap.bundle.min.js" integrity="sha512-43iShtbiyImxjjU4a9rhXBy7eKtIsrpll8xKhe1ghKqh5NyfME8phZs5JRFZpRBe1si44WM3tNmnqMym7JRmDQ==" crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/ejs@3.1.6/ejs.min.js" integrity="sha256-mOsgtygNfXBUPc/+cc19yr+g0jieqYOgRL5xFD2sC0Y=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js" integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" integrity="sha512-PEsccDx9jqX6Dh4wZDCnWMaIO3gAaU0j46W//sSqQhUQxky6/eHZyeB3NrXD2xsyugAKd4KPiDANkcuoEa2JuA==" crossorigin="anonymous"></script>

        <script src="/assets/js/clipboard-copy.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@codersrank/summary@0.9.11/codersrank-summary.min.js" integrity="sha256-Z9affdapY+YHkNg/94RW+PQsB8AEvfTzX33ip4Yof/o=" crossorigin="anonymous"></script>

        <!-- fancy UI stuff -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.slim.min.js" integrity="sha512-6ORWJX/LrnSjBzwefdNUyLCMTIsGoNP6NftMy2UAm1JBm6PRZCO1d7OHBStWpVFZLO+RerTvqX/Z9mBFfCJZ4A==" crossorigin="anonymous"></script>

        <script src="/assets/js/jquery.stellar.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery-js/1.4.0/js/lightgallery.min.js" integrity="sha512-b4rL1m5b76KrUhDkj2Vf14Y0l1NtbiNXwV+SzOzLGv6Tz1roJHa70yr8RmTUswrauu2Wgb/xBJPR8v80pQYKtQ==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery-js/1.4.0/css/lightgallery.min.css" integrity="sha512-kwJUhJJaTDzGp6VTPBbMQWBFUof6+pv0SM3s8fo+E6XnPmVmtfwENK0vHYup3tsYnqHgRDoBDTJWoq7rnQw2+g==" crossorigin="anonymous" />        

        <script src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js" integrity="sha512-CEiA+78TpP9KAIPzqBvxUv8hy41jyI3f2uHi7DGp/Y/Ka973qgSdybNegWFciqh6GrN2UePx2KkflnQUbUhNIA==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0.0/jquery.counterup.min.js" integrity="sha512-d8F1J2kyiRowBB/8/pAWsqUl0wSEOkG5KATkVV4slfblq9VRQ6MyDZVxWl2tWd+mPhuCbpTB4M7uU/x9FlgQ9Q==" crossorigin="anonymous"></script>

        <!--        
        <script src="/assets/js/simple-dom-filter.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mixitup/2.0.5/jquery.mixitup.min.js" integrity="sha512-NlMlh/p9Kag9mg+RDVYj1f8VHwcrWn3+ICeUnwL3XcBpdGr1dsYq15SZ+YWEsmg8Qxs3sWv2tcolAbYeT+uv4g==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha512-Zq2BOxyhvnRFXu0+WE6ojpZLOU2jdnqbrM1hmVdGzyeCa1DgM3X5Q4A/Is9xA1IkbUeDd7755dNNI/PzSf2Pew==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/filterizr/2.2.4/vanilla.filterizr.min.js" integrity="sha512-MMprw2AB5GAiQmXXEz5JYiGq2waU0iqD7Whj33m1w0V6Zzt1wyTFnr6rxWW8mfdQ/VksbUkU5c8sVGlO+3stew==" crossorigin="anonymous"></script>
        -->

        <script src="https://cdnjs.cloudflare.com/ajax/libs/tiny-slider/2.9.3/tiny-slider.min.js" integrity="sha512-eFH1e5TOppR2v/FrKk5FT/W9IHX25gKlrlTjIAuuG3pdDTMi3s8nR5PftWQ31fMpaF7P6NmlQXJjBwORWMLRLQ==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tiny-slider/2.9.3/tiny-slider.min.css" integrity="sha512-06CZo7raVnbbD3BlY8/hGUoUCuhk8sTdVGV3m3nuh9i2R+UmkLbLRTE/My8TuJ3ALbDulhBObJQWtOUt0mXzNQ==" crossorigin="anonymous" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.js" integrity="sha512-FofOhk0jW4BYQ6CFM9iJutqL2qLk6hjZ9YrS2/OnkqkD5V4HFnhTNIFSAhzP3x//AD5OzVMO8dayImv06fq0jA==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timecircles/1.5.3/TimeCircles.min.css" integrity="sha512-lZ3AwSh5B+1EgCuXvjkdhFX8xU4dMDO8SPqAn71VFY4luNN8gwKpajLxaZRMSeNMghUghfodtkZAWO2rM7H6Qw==" crossorigin="anonymous" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" integrity="sha512-A7AYk1fGKX6S2SsHywmPkrnzTZHrgiVT7GcQkLGDe2ev0aWb8zejytzS8wjo7PGEXKqJOrjQ4oORtnimIRZBtw==" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" integrity="sha512-1cK78a1o+ht2JcaW6g8OXYwqpev9+6GqOkz9xmBN9iUUhIndKtxwILGWYOSibOKjLsEdjyjZvYDq/cZwNeak0w==" crossorigin="anonymous" />

        <script src="https://cdn.jsdelivr.net/npm/menuspy@1.3.0/dist/menuspy.min.js" integrity="sha256-nLsUsNbD5SyESe6GrfVY1ay1ThxDUl5FZPqwhFRCzxA=" crossorigin="anonymous"></script>
        
    </head>
    <body>

        <header class="sticky-top">
            <nav class="navbar navbar-expand-lg">

    <div class="container">

        <a class="navbar-brand align-middle" href="#">
            <img src="/assets/img/reflection.png" />
        </a>

        <div class="ms-auto mx-2"></div>

        <a type="button" role="button" class="btn border-0 me-2 d-lg-none"
            data-bs-toggle="collapse" data-bs-target="#blog-search-bar">
            <!-- d-sm-none = hide if above sm -->
            <i class="fas fa-search"></i>
        </a>

        <button type="button" class="btn navbar-toggler"
            data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <!-- Using navbar-toggler fix in main.scss and FA icons instead of: <span class="navbar-toggler-icon"></span> -->
            <i class="fas fa-bars"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarNavDropdown">

            <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-sm-0">

                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="/">Home</a>
                </li>

                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="/projects">Projects</a>
                </li>

                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="/clients">Clients</a>
                </li>

                <li class="nav-item col-6 col-lg-auto">
                    <!-- NOTE: d-table on the group and nav-link d-inline for the inner <a> tags is a must for split button to work properly when collapsed/expanded -->
                    <div class="btn-group d-table nav-link p-2">
                        <a class="nav-link d-inline" href="/posts/1/">Blog posts</a>
                        <a class="nav-link d-inline" role="button" data-bs-toggle="dropdown">
                            <i class="far fa-caret-square-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/categories">Categories</a></li>
                            <li><a class="dropdown-item" href="/tags">Tags</a></li>
                            <li><a class="dropdown-item" href="/series">Series</a></li>
                            <!-- <li><hr class="dropdown-divider"></li> -->
                        </ul>
                    </div>
                </li>

            </ul>

            <hr class="d-lg-none text-light">

            <ul class="navbar-nav flex-row flex-wrap ms-lg-auto">
                
                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="https://www.linkedin.com/in/hideghety" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-linkedin"></i>
                        <small class="d-lg-none ms-2">LinkedIn</small>
                    </a>
                </li>
                
                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="https://github.com/hidegh" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-github"></i>
                        <small class="d-lg-none ms-2">GitHub</small>
                    </a>
                </li>
                
                <li class="nav-item col-6 col-lg-auto">
                    <a class="nav-link p-2" href="https://twitter.com/balazsHIDEGHETY" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-twitter"></i>
                        <small class="d-lg-none ms-2">Twitter</small>
                    </a>
                </li>
                
            </ul>

        </div>

        <!-- inline search-bar with same expand breakpoint as navigation -->
        <nav class="nav-search d-none d-lg-inline">
            <!-- hidden by def., visible (block) aft. size SM -->
            <div class="inline-input-group inline-text-right">
                <span class="inline-text"><i class="fas fa-search"></i></span>
                <input type="text" class="blog-search-input form-control py-0" placeholder="Search...">
            </div>
        </nav>

    </div>

</nav>

<!-- standalone search bar (below navigation) with same breakpoint as navigation (shown on collapse) -->
<nav class="nav-search-below d-lg-none collapse p-3" id="blog-search-bar">

    <div class="container">

        <!-- d-sm-none = hide if above sm -->
        <div class="inline-input-group inline-text-left">
            <span class="inline-text"><i class="fas fa-search"></i></span>
            <input type="text" class="blog-search-input form-control" placeholder="Search...">
        </div>

    </div>

</nav>
        </header>

        <main>
            
            

    

    <div class="container">

        <div id="global-content-view" class="row pt-3">

            <div class="col-12 col-xl-9 p-0 overflow-hidden">
                

    
    

    <section class="p-3 d-flex d-flex justify-content-between align-items-center">
        <section class="share-wrapper">
    <span class="share-label text-muted mr-1">Share:</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/enable-google-page-views/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fab fa-fw fa-linkedin"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Enable Google Page Views&amp;url=/post/enable-google-page-views/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fab fa-fw fa-twitter"></i>
                </a>
            
        
            
        
            
        
            
        

        <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>
    </section>

    <article class="print-container p-3">

        <section>
            <h1>Enable Google Page Views</h1>
            
        </section>

        <section class="pb-3">
            <div class="small pb-1">
                
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/tags"><i class="fas fa-fw fa-tags"></i></a>
    </div>
    <div class="d-inline-block">
        
        <a href="/tag/google-analytics/1/" class="me-1">google analytics</a>
        
        <a href="/tag/pageviews/1/" class="me-1">pageviews</a>
        
    </div>
</div>

                
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/categories"><i class="far fa-fw fa-folder-open"></i></a>
    </div>
    <div class="d-inline-block">
        
        
        <a href="/category/blogging/tutorial/1/" class="me-1">
                
            Blogging
                
             - Tutorial
            
        </a>
        
    </div>
</div>

            </div>
            <div class="row row-cols-auto gx-3">
                <div class="col"><i class="far fa-fw fa-calendar-alt"></i>Invalid DateTime</div>
                <div class="col"><i class="far fa-fw fa-user"></i>Dinesh Prasanth Moluguwan Krishnamoorthy</div>
                <div class="col"><i class="fas fa-fw fa-stopwatch"></i> 5 min reading time</div>
            </div>
        </section>

        <section class="pb-3">
            
            <p>This post is to enable Page Views on the <a href="https://github.com/cotes2020/jekyll-theme-chirpy/"><strong>Chirpy</strong></a> theme based blog that you just built. This requires technical knowledge and it’s recommended to keep the <code>google_analytics.pv</code> disabled unless you have a good reason. If your website has low traffic, the page views count would discourage you to write more blogs. With that said, let’s start with the setup.</p>
<h2 id="set-up-google-analytics">Set up Google Analytics</h2>
<h3 id="create-ga-account-and-property">Create GA account and property</h3>
<p>First, you need to setup your account on Google analytics. While your create your account, you must create your first <strong>Property</strong> as well.</p>
<ol>
<li>Head to <a href="https://analytics.google.com/">https://analytics.google.com/</a> and click on <strong>Start Measuring</strong></li>
<li>Enter your desired <em>Account Name</em> and choose the desired checkboxes</li>
<li>Enter your desired <em>Property Name</em>. This is the name of the tracker project that appears on your Google Analytics dashboard</li>
<li>Enter the required information <em>About your business</em></li>
<li>Hit <em>Create</em> and accept any license popup to setup your Google Analytics account and create your property</li>
</ol>
<h3 id="create-data-stream">Create Data Stream</h3>
<p>With your property created, you now need to set up Data Stream to track your blog traffic. After you signup, the prompt should automatically take you to creating your first <strong>Data Stream</strong>. If not, follow these steps:</p>
<ol>
<li>Go to <strong>Admin</strong> on the left column</li>
<li>Select the desired property from the drop down on the second column</li>
<li>Click on <strong>Data Streams</strong></li>
<li>Add a stream and click on <strong>Web</strong></li>
<li>Enter your blog’s URL</li>
</ol>
<p>It should look like this:</p>
<p><img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/01-google-analytics-data-stream.png" alt="google-analytics-data-stream"></p>
<p>Now, click on the new data stream and grab the <strong>Measurement ID</strong>. It should look something like <code>G-V6XXXXXXXX</code>. Copy this to your <code>_config.yml</code> file</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">google_analytics</span><span class="token punctuation">:</span><br>  <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token string">'G-V6XXXXXXX'</span>          <span class="token comment"># Fill with your Google Analytics ID</span><br>  <span class="token key atrule">pv</span><span class="token punctuation">:</span><br>    <span class="token comment"># The Google Analytics pageviews switch.</span><br>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span><br>    <span class="token comment"># the next options only valid when `google_analytics.pv` is enabled.</span><br>    <span class="token key atrule">proxy_url</span><span class="token punctuation">:</span> <span class="token string">''</span><br>    <span class="token key atrule">proxy_endpoint</span><span class="token punctuation">:</span> <span class="token string">''</span><br>    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>  <span class="token comment"># pv data local cache, good for the users from GFW area.</span></code></pre>
<p>When you push these changes to your blog, you should start seeing the traffic on your Google Analytics. Play around with Google Analytics dashboard to get familiar with the options available as it takes like 5 mins to pickup your changes. You should now be able to monitor your traffic in realtime.</p>
<p><img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/02-google-analytics-realtime.png" alt="google-analytics-realtime"></p>
<h2 id="setup-page-views">Setup Page Views</h2>
<p>There is a detailed <a href="https://developers.google.com/analytics/solutions/google-analytics-super-proxy">tutorial</a> available to set up Google Analytics superProxy. But, if you are interested to just quickly get your Chirpy-based blog display page views, follow along. These steps were tested on a Linux machine. If you are running Windows, you can use Git bash terminal to run Unix-like commands.</p>
<h3 id="setup-google-app-engine">Setup Google App Engine</h3>
<ol>
<li>
<p>Visit <a href="https://console.cloud.google.com/appengine">https://console.cloud.google.com/appengine</a></p>
</li>
<li>
<p>Click on <strong>Create Application</strong></p>
</li>
<li>
<p>Click on <strong>Create Project</strong></p>
</li>
<li>
<p>Enter the name and choose the data center close to you</p>
</li>
<li>
<p>Select <strong>Python</strong> language and <strong>Standard</strong> environment</p>
</li>
<li>
<p>Enable billing account. Yeah, you have to link your credit card. But, you won’t be billed unless you exceed your free quota. For a simple blog, free quota is more than sufficient.</p>
</li>
<li>
<p>Go to your App Engine dashboard on your browser and select <strong>API &amp; Services</strong> from the left navigation menu</p>
</li>
<li>
<p>Click on <strong>Enable APIs and Services</strong> button on the top</p>
</li>
<li>
<p>Enable the following APIs: <em>Google Analytics API</em></p>
</li>
<li>
<p>On the left, Click on <em>OAuth Consent Screen</em> and accept <strong>Configure Consent Screen</strong>. Select <strong>External</strong> since your blog is probably hosted for the public. Click on <strong>Publish</strong> under <em>Publishing Status</em></p>
</li>
<li>
<p>Click on <strong>Credentials</strong> on the left and create a new <strong>OAuth Client IDs</strong> credential. Make sure to add a entry under <code>Authorized redirect URIs</code> that matches: <code>https://&lt;project-id&gt;.&lt;region&gt;.r.appspot.com/admin/auth</code></p>
</li>
<li>
<p>Note down the <strong>Your Client ID</strong> and <strong>Your Client Secret</strong>. You’ll need this in the next section.</p>
</li>
<li>
<p>Download and install the cloud SDK for your platform: <a href="https://cloud.google.com/sdk/docs/quickstart">https://cloud.google.com/sdk/docs/quickstart</a></p>
</li>
<li>
<p>Run the following commands:</p>
<pre><code>[root@bc96abf71ef8 /]# gcloud init

~snip~

Go to the following link in your browser:

    https://accounts.google.com/o/oauth2/auth?response_type=code&amp;client_id=XYZ.apps.googleusercontent.com&amp;redirect_uri=ABCDEFG

Enter verification code: &lt;VERIFICATION CODE THAT YOU GET AFTER YOU VISIT AND AUTHENTICATE FROM THE ABOVE LINK&gt;

You are logged in as: [blah_blah@gmail.com].

Pick cloud project to use:
[1] chirpy-test-300716
[2] Create a new project
Please enter numeric choice or text value (must exactly match list
item): 1


[root@bc96abf71ef8 /]# gcloud info
# Your selected project info should be displayed here
</code></pre>
</li>
</ol>
<h3 id="setup-google-analytics-superproxy">Setup Google Analytics superProxy</h3>
<ol>
<li>
<p>Clone the <strong>Google Analytics superProxy</strong> project on Github: <a href="https://github.com/googleanalytics/google-analytics-super-proxy">https://github.com/googleanalytics/google-analytics-super-proxy</a> to your local.</p>
</li>
<li>
<p>Remove the first 2 lines in the <a href="https://github.com/googleanalytics/google-analytics-super-proxy/blob/master/src/app.yaml#L1-L2"><code>src/app.yaml</code></a> file:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">-application</span><span class="token punctuation">:</span> your<span class="token punctuation">-</span>project<span class="token punctuation">-</span>id<br><span class="token key atrule">-version</span><span class="token punctuation">:</span> <span class="token number">1</span></code></pre>
</li>
<li>
<p>In <code>src/config.py</code>, add the <code>OAUTH_CLIENT_ID</code> and <code>OAUTH_CLIENT_SECRET</code> that you gathered from you App Engine Dashboard.</p>
</li>
<li>
<p>Enter any random key for <code>XSRF_KEY</code>, your <code>config.py</code> should look similar to this</p>
<pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/bin/python2.7</span><br><br>__author__ <span class="token operator">=</span> <span class="token string">'pete.frisella@gmail.com (Pete Frisella)'</span><br><br><span class="token comment"># OAuth 2.0 Client Settings</span><br>AUTH_CONFIG <span class="token operator">=</span> <span class="token punctuation">{</span><br>  <span class="token string">'OAUTH_CLIENT_ID'</span><span class="token punctuation">:</span> <span class="token string">'YOUR_CLIENT_ID'</span><span class="token punctuation">,</span><br>  <span class="token string">'OAUTH_CLIENT_SECRET'</span><span class="token punctuation">:</span> <span class="token string">'YOUR_CLIENT_SECRET'</span><span class="token punctuation">,</span><br>  <span class="token string">'OAUTH_REDIRECT_URI'</span><span class="token punctuation">:</span> <span class="token string">'%s%s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><br>    <span class="token string">'https://chirpy-test-XXXXXX.ue.r.appspot.com'</span><span class="token punctuation">,</span><br>    <span class="token string">'/admin/auth'</span><br>  <span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment"># XSRF Settings</span><br>XSRF_KEY <span class="token operator">=</span> <span class="token string">'OnceUponATimeThereLivedALegend'</span></code></pre>
<p><strong>Tip:</strong> You can configure a custom domain instead of <code>https://PROJECT_ID.REGION_ID.r.appspot.com</code>. But, for the sake of keeping it simple, we will be using the Google provided default URL.</p>
</li>
<li>
<p>From inside the src/ directory, deploy the app</p>
<pre><code>[root@bc96abf71ef8 src]# gcloud app deploy
Services to deploy:

descriptor:      [/tmp/google-analytics-super-proxy/src/app.yaml]
source:          [/tmp/google-analytics-super-proxy/src]
target project:  [chirpy-test-XXXX]
target service:  [default]
target version:  [VESRION_NUM]
target url:      [https://chirpy-test-XXXX.ue.r.appspot.com]


Do you want to continue (Y/n)? Y

Beginning deployment of service [default]...
╔════════════════════════════════════════════════════════════╗
╠═ Uploading 1 file to Google Cloud Storage                 ═╣
╚════════════════════════════════════════════════════════════╝
File upload done.
Updating service [default]...done.
Setting traffic split for service [default]...done.
Deployed service [default] to [https://chirpy-test-XXXX.ue.r.appspot.com]

You can stream logs from the command line by running:
$ gcloud app logs tail -s default

To view your application in the web browser run:
$ gcloud app browse
</code></pre>
</li>
<li>
<p>Visit the deployed service. Add a <code>/admin</code> to the end of the URL.</p>
</li>
<li>
<p>Click on <strong>Authorize Users</strong> and make sure to add yourself as a managed user.</p>
</li>
<li>
<p>If you get any errors, please Google it. The errors are self-explanatory and should be easy to fix.</p>
</li>
</ol>
<p>If everything went good, you’ll get this screen:</p>
<p><img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/03-superProxy-deployed.png" alt="superProxy-deployed"></p>
<h3 id="create-google-analytics-query">Create Google Analytics Query</h3>
<p>Head to <code>https://PROJECT_ID.REGION_ID.r.appspot.com/admin</code> and create a query after verifying the account. <strong>GA Core Reporting API</strong> query request can be created in <a href="https://ga-dev-tools.appspot.com/query-explorer/">Query Explorer</a>.</p>
<p>The query parameters are as follows:</p>
<ul>
<li><strong>start-date</strong>: fill in the first day of blog posting</li>
<li><strong>end-date</strong>: fill in <code>today</code> (this is a parameter supported by GA Report, which means that it will always end according to the current query date)</li>
<li><strong>metrics</strong>: select <code>ga:pageviews</code></li>
<li><strong>dimensions</strong>: select <code>ga:pagePath</code></li>
</ul>
<p>In order to reduce the returned results and reduce the network bandwidth, we add custom filtering rules [^ga-filters]:</p>
<ul>
<li>
<p><strong>filters</strong>: fill in <code>ga:pagePath=~^/posts/.*/$;ga:pagePath!@=</code>.</p>
<p>Among them, <code>;</code> means using <em>logical AND</em> to concatenate two rules.</p>
<p>If the <code>site.baseurl</code> is specified, change the first filtering rule to <code>ga:pagePath=~^/BASE_URL/posts/.*/$</code>, where <code>BASE_URL</code> is the value of <code>site.baseurl</code>.</p>
</li>
</ul>
<p>After <kbd>Run Query</kbd>, copy the generated contents of <strong>API Query URI</strong> at the bottom of the page, and fill in the <strong>Encoded URI for the query</strong> of SuperProxy on GAE.</p>
<p>After the query is saved on GAE, a <strong>Public Endpoint</strong> (public access address) will be generated, and we will get the query result in JSON format when accessing it. Finally, click <kbd>Enable Endpoint</kbd> in <strong>Public Request Endpoint</strong> to make the query effective, and click <kbd>Start Scheduling</kbd> in <strong>Scheduling</strong> to start the scheduled task.</p>
<p><img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/04-superproxy-query.png" alt="superproxy-query"></p>
<h2 id="configure-chirpy-to-display-page-view">Configure Chirpy to Display Page View</h2>
<p>Once all the hard part is done, it is very easy to enable the Page View on Chirpy theme. Your superProxy dashboard should look something like below and you can grab the required values.</p>
<p><img src="https://cdn.jsdelivr.net/gh/cotes2020/chirpy-images/posts/20210103/05-superproxy-dashboard.png" alt="superproxy-dashboard"></p>
<p>Update the <code>_config.yml</code> file of <a href="https://github.com/cotes2020/jekyll-theme-chirpy/"><strong>Chirpy</strong></a> project with the values from your dashboard, to look similar to the following:</p>
<pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">google_analytics</span><span class="token punctuation">:</span><br>  <span class="token key atrule">id</span><span class="token punctuation">:</span> <span class="token string">'G-XXXXXXXXXX'</span>   <span class="token comment"># Fill with your Google Analytics ID</span><br>  <span class="token key atrule">pv</span><span class="token punctuation">:</span><br>    <span class="token comment"># The Google Analytics pageviews switch.</span><br>    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><br>    <span class="token comment"># the next options only valid when `google_analytics.pv` is enabled.</span><br>    <span class="token key atrule">proxy_url</span><span class="token punctuation">:</span> <span class="token string">'https://PROJECT_ID.REGION_ID.r.appspot.com'</span><br>    <span class="token key atrule">proxy_endpoint</span><span class="token punctuation">:</span> <span class="token string">'https://PROJECT_ID.REGION_ID.r.appspot.com/query?id=&lt;ID FROM SUPER PROXY>'</span><br>    <span class="token key atrule">cache</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>      <span class="token comment"># pv data local cache, good for the users from GFW area.</span></code></pre>
<p>Now, you should see the Page View enabled on your blog.</p>
<h2 id="reference">Reference</h2>
<p>[^ga-filters]: <a href="https://developers.google.com/analytics/devguides/reporting/core/v3/reference#filters">Google Analytics Core Reporting API: Filters</a></p>

        </section>

    </article>

    <section class="p-3 d-flex d-flex justify-content-between align-items-center">
        <section class="share-wrapper">
    <span class="share-label text-muted mr-1">Share:</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/enable-google-page-views/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fab fa-fw fa-linkedin"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Enable Google Page Views&amp;url=/post/enable-google-page-views/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fab fa-fw fa-twitter"></i>
                </a>
            
        
            
        
            
        
            
        

        <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>
        <div class="small">
            
<div class="license-wrapper">
    This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.
</div>

        </div>
    </section>

    <section class="p-3">
        
<div class="d-flex">
    <div class="post-navigation-button text-start me-auto">
        <a href="/post/ddd-series-1-intro/" title="DDD Series - 1 - Intro"><i class="fas fa-2x fa-chevron-left align-middle"></i>&nbsp;Previous</a>
    </div>
    
    <div class="post-navigation-button text-end ms-auto">
        <a href="/post/clean-code-quick-recap/" title="Clean code - Quick recap">Next&nbsp;<i class="fas fa-2x fa-chevron-right align-middle"></i></a>
    </div>
    </div>
    </section>

    <hr/>

    <section class="p-3">
        
<!--
    Based on: Jekyll - Chirpy + extension to support CC

    Inserts DISQUS to the page.
    Also loads necessary scripts and sets disqus identifier to the given page URL.

    Usage (on the page / post layout):

        
-->
<div id="disqus">
    <p class="font-italic text-center text-muted small">
        Comments powered by <a href="https://disqus.com/">Disqus</a> - function requires cookie consent (see drawer at the bottom right corner)!
    </p>
</div>

<script src="/assets/js/disqusloader.min.js"></script>

<script>
    function loadDisqus() {
        var options = {
            scriptUrl: '//hidegh-github-io.disqus.com/embed.js',

            disqusConfig: function () {
                this.page.url = document.location.origin + '/post/enable-google-page-views/';
                this.page.identifier = '/post/enable-google-page-views/';
            }
        };

        disqusLoader('#disqus', options);
    }
</script>

    </section>
  

            </div>

            <aside class="sticky-container d-none d-xl-block small col-xl-3 p-0">
                

    <section class="sticky p-3 mb-3">
        
<div class="heading">
    <h2 class="d-inline">Recent posts</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        
<ul class="recent-posts">
    
    <li>
        <a href="/post/ddd-series-10-forbidden-location/">
            <span>DDD Series - 10 - Forbidden location</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-9-summary/">
            <span>DDD Series - 9 - Summary</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-8-bounded-context-at-help-to-tackle-complexity/">
            <span>DDD Series - 8 - Bounded context at help to tackle complexity</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-7-testing-is-easy-with-ddd/">
            <span>DDD Series - 7 - Testing is easy with DDD</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-6-the-lazy-way-towards-ddd-(using-orm)/">
            <span>DDD Series - 6 - The lazy way towards DDD (using ORM)</span>
        </a>
    </li>
    
</ul>


    </section>
    
    <section class="sticky p-3 mb-3 d-hide-if-empty">
        
<div class="heading">
    <h2 class="d-inline">Tag cloud</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

         
    <span style="font-size: 0.8em;">
        <a href="/tag/clean-code/1/">clean-code</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/ddd/1/">ddd</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/favicon/1/">favicon</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/getting-started/1/">getting started</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/google-analytics/1/">google analytics</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/hr/1/">HR</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/intro/1/">intro</a>
    </span>
 
    <span style="font-size: 1em;">
        <a href="/tag/management/1/">management</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/mytag/1/">myTag</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/outer-middle-inner/1/">outer - middle - inner</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/pageviews/1/">pageviews</a>
    </span>
 
    <span style="font-size: 1.8em;">
        <a href="/tag/posts/1/">posts</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/posts-technical-management-estimation-recap-this-is-a-single-big-tag-name!/1/">posts, technical, management, estimation, recap - this is a single big tag name!</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/programming/1/">programming</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/recap/1/">recap</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/series/1/">series</a>
    </span>
 
    <span style="font-size: 1.6666666666666667em;">
        <a href="/tag/technical/1/">technical</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/typography/1/">typography</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/writing/1/">writing</a>
    </span>


    </section>

    <section class="sticky p-3 mb-3 d-hide-if-empty">
        
<div class="heading">
    <h2 class="d-inline">Related articles</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        <div class="text-nowrap overflow-hidden">
        

<ul class="related-posts">
    
    <li>
        
        <a href="/post/fix-employee-retention/">
            <span>Fix-employee-retention</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/ddd-series-8-bounded-context-at-help-to-tackle-complexity/">
            <span>DDD Series - 8 - Bounded context at help to tackle complexity</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/ddd-series-5-the-hardcore-way-to-ddd/">
            <span>DDD Series - 5 - The hardcore way to DDD</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/estimation-quick-recap/">
            <span>Estimation - Quick recap</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/ddd-series-10-forbidden-location/">
            <span>DDD Series - 10 - Forbidden location</span>
        </a>
    </li>
    
</ul>

        </div>
    </section>
    
    <section class="p-3 mb-3 d-hide-if-empty sticky">
        
<div class="heading">
    <h2 class="d-inline">Remove me</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        <div class="text-nowrap overflow-hidden">
        

<h2>Content</h2>
<nav class="toc">
                <ol>
                    
                    <li><a href="#set-up-google-analytics">Set up Google Analytics</a>
            
                <ol>
                    
                    <li><a href="#create-ga-account-and-property">Create GA account and property</a>
            		</li>

                    <li><a href="#create-data-stream">Create Data Stream</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#setup-page-views">Setup Page Views</a>
            
                <ol>
                    
                    <li><a href="#setup-google-app-engine">Setup Google App Engine</a>
            		</li>

                    <li><a href="#setup-google-analytics-superproxy">Setup Google Analytics superProxy</a>
            		</li>

                    <li><a href="#create-google-analytics-query">Create Google Analytics Query</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#configure-chirpy-to-display-page-view">Configure Chirpy to Display Page View</a>
            		</li>

                    <li><a href="#reference">Reference</a>
            		</li>
                </ol>
            </nav>

        </div>
    </section>


            </aside>

        </div>

        <div id="search-results-container" class="row pt-3 d-none">
            <div class="search-results col-12">
            </div>
        </div>

    </div>

    


        </main>

        
        

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>

<script>
    const scripts_config = {

        defaultCookies: function () {
            console.log('default cookies');

            // note: using anonymized IP
            if (typeof loadGA === 'function') loadGA(true);
        },

        enableCookies: function () {
            console.log('enabled cookies');

            if (typeof loadGA === 'function') loadGA(false);
            if (typeof loadDisqus === 'function') loadDisqus();
        },

        disableCookies: function () {
            console.log('disabled cookies');

            this.defaultCookies();
        },

        loadScripts: function (requireConsent, consentUrl) {
            if (requireConsent) {
                // scripts managed based on consent status
                this.initializeCookieConsent(consentUrl);
            } else {
                // all scripts enabled
                this.enableCookies();
            }
        },

        initializeCookieConsent: function (consentUrl) {

            const me = this;

            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#edeff5",
                        "text": "#838391"
                    },
                    "button": {
                        "background": "#4b81e8"
                    }
                },
                "position": "bottom-right",
                "type": "opt-in",
                "content": {
                    "message": "This website uses cookies to ensure you get the best experience here.",
                    "href": consentUrl
                },

                onInitialise: function (status) {
                    console.log(`cc - onInitialise, status: ${status}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    if (type == 'opt-in' && didConsent) {
                        me.enableCookies();
                    }
                    else if (type == 'opt-out' && !didConsent) {
                        me.disableCookies();
                    }
                    else {
                        me.defaultCookies();
                    }
                },

                onStatusChange: function (status, chosenBefore) {
                    console.log(`cc - onStatusChange, status: ${status}, chosenBefore: ${chosenBefore}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    if (type == 'opt-in' && didConsent) {
                        me.enableCookies();
                    }
                    if (type == 'opt-out' && !didConsent) {
                        me.disableCookies();
                    }
                },

                onRevokeChoice: function () {
                    // NOTE: this hook is called immediately after the revoke button is clicked and removes previous answers
                    console.log(`cc - onRevokeChoice`);

                    var type = this.options.type;
                    if (type == 'opt-in') {
                        me.disableCookies();

                        // NOTE: we need to reload page, so that we get rid of the loaded GA / Disqus scripts!
                        location.reload();
                    }
                    if (type == 'opt-out') {
                        me.enableCookies();
                    }
                },

                onPopupOpen: function () {
                    console.log(`cc - onPopupOpen`);
                },

                onPopupClose: function () {
                    console.log(`cc - onPopupClose`);
                }

            });

        }

    };

    const requireConsent = JSON.parse('true');
    const consentUrl = '/cookies.html';
    
    scripts_config.loadScripts(requireConsent, consentUrl);
</script>



        <script>

    /* uses:
    EJS.CO for templating
    LUNR for search
    HE for HTML encoding (at highlight fnc.)
    */
   
    class Debouncer {
        _timeoutId = undefined;
        _wait = 250;
        _callback;

        constructor(callback, wait) {
            this._wait = wait ? wait : this._wait;
            this._callback = callback;
        }

        next(...args) {
            this.cancel();
            this._timeoutId = window.setTimeout(() => {
            this._callback.apply(null, args);
            }, this._wait);
        }

        cancel() {
            window.clearTimeout(this._timeoutId);
        }
    }

    const blogSearch = {

        _searchIndexPath: '/search.json',
        _urlPrefix: '/',
        _debounceTime: 400,

        _searchingTemplate: `
<h2>
    <i class="text-secondary fas fa-spin fa-circle-notch"></i>
    <span class="text-secondary">Searching for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>
`,

        _resultTemplate: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<ul class="search-results">
<% searchResults.forEach((sr) => { %>
    <li>
        <div class="search-result-item position-relative border shadow">
            <h5><%- sr.ref.title %></h5>
            <p class="x-text-nowrap x-text-truncate"><%- sr.ref.summary %></p>
            <a href="<%- urlPrefix %><%- sr.ref.url %>" class="stretched-link"></a>
        </div>
    </li>
<% }); %>
</ul>        
`,

        _inputElements: [],
        _cancelElements: [],
        
        _updateInputs(value) {
            this._inputElements.forEach(el => el.value = value);
        },

        _setUpListeners(inputSelector, cancelSelector) {
            if (inputSelector) {
                this._inputElements = document.querySelectorAll(inputSelector);
                this._inputElements.forEach(el => el.addEventListener('keyup', evt => { if (evt.keyCode == 27) this._escapePressed(el); else this._inputValueChanged(el); } ));
            } else {
                this._inputElements = [];
            }

            if (cancelSelector) {
                this._cancelElements = document.querySelectorAll(cancelSelector);
            } else {
                this._cancelElements = [];
            }
        },

        _escapePressed(el) {
            this.clearSearch();
        },

        _inputValueChanged(el) {
            const value = el.value;
            this._updateInputs(value);
            this._debouncedSearch.next(value);
        },

        _resultContainerEls: [],
        _containersToHideEls: [],

        _setUpContainers(resultContainerSelector, containersToHideWhenResultSelector) {
            this._resultContainerEls = document.querySelectorAll(resultContainerSelector);
            this._containersToHideEls = document.querySelectorAll(containersToHideWhenResultSelector);
        },

        _showResults: false,
        _searching: false,
        _searchText: '',
        _searchResults: [],

        refreshUi() {
            const self = this;

            self._inputElements.forEach(el => el.value = self._searchText );

            const html = self._showResults
                ? self._searching
                    ? ejs.render(self._searchingTemplate, { searchText: self._searchText })
                    : ejs.render(self._resultTemplate, { urlPrefix: self._urlPrefix.replace(/\/+$/, ''), searchText: self._searchText, searchResults: self._searchResults })
                : '';

            self._resultContainerEls.forEach(el => { 
                // hide/show container
                self._showResults ? el.classList.remove("d-none") : el.classList.add("d-none")
                
                // find results element and set results
                const resultsEl = el.querySelector(".search-results");
                if (resultsEl) {
                    resultsEl.innerHTML = self._showResults ? html : "";
                }
            });

            self._containersToHideEls.forEach(el => self._showResults ? el.classList.add("d-none") : el.classList.remove("d-none"));          
        },

        clearSearch() {
            this._showResults = false;
            this._searchText = '';
            this._searchResults = [];
            this.refreshUi();
        },

        search(text) {

            const self = this;

            console.log('searching for: ', text);
            self._searchText = text;

            if (!text) {
                self.clearSearch();
                return;
            }

            this._searchResults = [];
            self._searching = true;
            self._showResults = true;
            this.refreshUi();

            const hasSpecial = self._lunrSpecial.some(special => text.includes(special));
            const pattern =  hasSpecial 
                ? text
                : text + "*";

            console.log('lunr pattern: ', pattern);
            const localResults = self._lunrEngine.search(pattern);

            // NOTE: just for tests...
            // console.log('total result', localResults)

            // NOTE: highlighting
            localResults.forEach(localResult => {
                // NOTE: hard. ref.
                const data = self._lunrSearchData.find(i => i.url == localResult.ref);

                const highlight = {};

                for (let term in localResult.matchData.metadata) {
                    for (let field in localResult.matchData.metadata[term]) {

                        const positions = localResult.matchData.metadata[term][field].position;

                        const fieldValue = data[field];
                        let fieldReadIndex = 0;

                        highlight[field] = "";

                        for (let position of positions) {

                            if (position[0] > fieldReadIndex)
                                highlight[field] += fieldValue.substring(fieldReadIndex, position[0]);

                            highlight[field] += ("{:::" + fieldValue.substring(position[0], position[0] + position[1]) + ":::}");

                            fieldReadIndex = position[0] + position[1];

                        }

                        highlight[field] += fieldValue.substring(fieldReadIndex);             

                    }

                }

                for (let key in highlight) {
                    let value = highlight[key];

                    const encode = false;
                    let encoded = encode
                        ? he.encode(value)
                        : value;

                    let highlighted = encoded.replace(/{:::/g, '<mark>').replace(/:::}/g, '</mark>');
                    highlight[key] = highlighted;
                }

                localResult.ref = Object.assign({}, data, highlight);
            });

            self._searchResults = localResults;

            // finally
            self._searching = false;
            self.refreshUi();
        },

        _lunrSpecial: "*+-:^~".split(''),
        _lunrSearchData: undefined,
        _lunrEngine: undefined,

        init(inputSelector, cancelSelector, resultContainerSelector, containersToHideWhenResultSelector) {

            console.log('initializing search', this);

            // set up result / hide elements
            this._setUpContainers(resultContainerSelector, containersToHideWhenResultSelector);

            // refresh
            this.refreshUi();

            fetch(this._searchIndexPath).then((response) => {
                response.json().then((raw) => {

                    // set up engine, store search data
                    this._lunrSearchData = raw;

                    this._lunrEngine = lunr(function () {
                        this.ref('url')
                        this.field('title')
                        this.field('date')
                        this.field('author')
                        this.field('summary')
                        this.field('text')

                        this.metadataWhitelist = ['position']

                        raw.forEach(function (doc) { this.add(doc) }, this)
                    });

                    // set up UI listeners
                    this._debouncedSearch = new Debouncer((args) => this.search(args), this._debounceTime);
                    this._setUpListeners(inputSelector, cancelSelector);

                    // refresh
                    this.refreshUi();
                });
            });

        }

    };

    // NOTE: search-results-container must have an additional element with a .search-results class
    blogSearch.init('.blog-search-input', '.blog-search-cancel', '#search-results-container', '#global-content-view');

</script>


    </body>

    <!-- dynamic scripts for content -->
    

    


    <script src="/assets/js/d-hide-if-empty.js"></script>
    <script src="/assets/js/sticky.js"></script>
    
</html>
