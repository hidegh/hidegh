<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta http-equiv="Cache-Control" content="max-age=3600, must-revalidate">
        <meta http-equiv="Pragma" content="no-cache">
        <meta http-equiv="Expires" content="-1">

        <title>Fix-employee-retention | Balazs&#39;s BLOG</title>
        <meta name="title" content="Fix-employee-retention | Balazs&#39;s BLOG">
        <meta name="description" content="Helping agencies &amp; SMEs to land easy to maintain projects and (remote) teams">
        <meta name="keywords" content="posts,technical,management,HR,digitalization,business,management,agile,software,softwareengineering,softwarearchitecture,programming">
        <meta name="author" content="BaHI">
        <meta name="robots" content="index, follow">

        <link rel="canonical" href="https://hidegh.github.io/post/fix-employee-retention/">
        <link rel="shortcut icon" type="image/png" href="/assets/img/favicon.png">
        
        <link rel="stylesheet" href="/assets/css/main.css" />

        <link rel="preconnect" href="cdnjs.cloudflare.com">
        <link rel="dns-prefetch" href="cdnjs.cloudflare.com">

        <link rel="preconnect" href="cdn.jsdelivr.net">
        <link rel="dns-prefetch" href="cdn.jsdelivr.net">

        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w==" crossorigin="anonymous" />

        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta2/js/bootstrap.bundle.min.js" integrity="sha512-43iShtbiyImxjjU4a9rhXBy7eKtIsrpll8xKhe1ghKqh5NyfME8phZs5JRFZpRBe1si44WM3tNmnqMym7JRmDQ==" crossorigin="anonymous"></script>

        <script src="https://cdn.jsdelivr.net/npm/ejs@3.1.6/ejs.min.js" integrity="sha256-mOsgtygNfXBUPc/+cc19yr+g0jieqYOgRL5xFD2sC0Y=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/2.3.9/lunr.min.js" integrity="sha512-4xUl/d6D6THrAnXAwGajXkoWaeMNwEKK4iNfq5DotEbLPAfk6FSxSP3ydNxqDgCw1c/0Z1Jg6L8h2j+++9BZmg==" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" integrity="sha512-PEsccDx9jqX6Dh4wZDCnWMaIO3gAaU0j46W//sSqQhUQxky6/eHZyeB3NrXD2xsyugAKd4KPiDANkcuoEa2JuA==" crossorigin="anonymous"></script>

        <script src="/assets/js/clipboard-copy.js"></script>
        
        <script src="https://cdn.jsdelivr.net/npm/@codersrank/summary@0.9.11/codersrank-summary.min.js" integrity="sha256-Z9affdapY+YHkNg/94RW+PQsB8AEvfTzX33ip4Yof/o=" crossorigin="anonymous"></script>

    </head>
    <body>

        <header class="sticky-top">
            <nav class="navbar navbar-expand-sm navbar-dark bg-dark">

    <div class="container">

        <a class="navbar-brand align-middle" href="#">Reflection</a>

        <div class="ms-auto mx-2"></div>

        <a type="button" role="button" class="btn btn-outline-light border-0 me-2 d-sm-none"
            data-bs-toggle="collapse" data-bs-target="#blog-search-bar">
            <!-- d-sm-none = hide if above sm -->
            <i class="fas fa-search"></i>
        </a>

        <button type="button" class="btn btn-outline-light navbar-toggler"
            data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
            aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <!-- Using navbar-toggler fix in main.scss and FA icons instead of: <span class="navbar-toggler-icon"></span> -->
            <i class="fas fa-bars"></i>
        </button>

        <div class="collapse navbar-collapse" id="navbarNavDropdown">

            <ul class="navbar-nav flex-row flex-wrap bd-navbar-nav pt-2 py-sm-0">

                <li class="nav-item col-6 col-sm-auto">
                    <a class="nav-link p-2" href="/">Home</a>
                </li>

                <li class="nav-item col-6 col-sm-auto">
                    <a class="nav-link p-2" href="/projects">Projects</a>
                </li>

                <li class="nav-item col-6 col-sm-auto">
                    <!-- NOTE: d-table on the group and nav-link d-inline for the inner <a> tags is a must for split button to work properly when collapsed/expanded -->
                    <div class="btn-group d-table nav-link p-2">
                        <a class="nav-link d-inline" href="/posts/1/">Blog posts</a>
                        <a class="nav-link d-inline" role="button" data-bs-toggle="dropdown">
                            <i class="far fa-caret-square-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/categories">Categories</a></li>
                            <li><a class="dropdown-item" href="/tags">Tags</a></li>
                            <li><a class="dropdown-item" href="/series">Series</a></li>
                            <!-- <li><hr class="dropdown-divider"></li> -->
                        </ul>
                    </div>
                </li>

            </ul>

            <hr class="d-sm-none text-light">

            <ul class="navbar-nav flex-row flex-wrap ms-sm-auto">
                
                <li class="nav-item col-6 col-sm-auto">
                    <a class="nav-link p-2" href="https://www.linkedin.com/in/hideghety" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-linkedin"></i>
                        <small class="d-sm-none ms-2">LinkedIn</small>
                    </a>
                </li>
                
                <li class="nav-item col-6 col-sm-auto">
                    <a class="nav-link p-2" href="https://github.com/hidegh" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-github"></i>
                        <small class="d-sm-none ms-2">GitHub</small>
                    </a>
                </li>
                
                <li class="nav-item col-6 col-sm-auto">
                    <a class="nav-link p-2" href="https://twitter.com/balazsHIDEGHETY" target="_blank"
                        rel="noopener">
                        <i class="fab fa-fw fa-twitter"></i>
                        <small class="d-sm-none ms-2">Twitter</small>
                    </a>
                </li>
                
            </ul>

        </div>

        <!-- inline search-bar with same expand breakpoint as navigation -->
        <button type="button" class="btn btn-dark d-none d-sm-inline">
            <!-- hidden by def., visible (block) aft. size SM -->
            <div class="inline-input-group inline-text-right">
                <span class="inline-text"><i class="fas fa-search bg-dark text-light"></i></span>
                <input type="text" class="blog-search-input form-control py-0 bg-dark text-light"
                    placeholder="Search...">
            </div>
        </button>

    </div>

</nav>

<!-- standalone search bar (below navigation) with same breakpoint as navigation (shown on collapse) -->
<nav class="d-sm-none collapse bg-light text-dark p-3" id="blog-search-bar">

    <div class="container">

        <!-- d-sm-none = hide if above sm -->
        <div class="inline-input-group inline-text-left">
            <span class="inline-text"><i class="fas fa-search"></i></span>
            <input type="text" class="blog-search-input form-control" placeholder="Search...">
        </div>

    </div>

</nav>
        </header>

        <main>
            
            

    

    <div class="container">

        <div id="global-content-view" class="row pt-3">

            <div class="col-12 col-xl-9 p-0 overflow-hidden">
                

    
    

    <section class="p-3 d-flex d-flex justify-content-between align-items-center">
        <section class="share-wrapper">
    <span class="share-label text-muted mr-1">Share:</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/fix-employee-retention/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fab fa-fw fa-linkedin"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Fix-employee-retention&amp;url=/post/fix-employee-retention/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fab fa-fw fa-twitter"></i>
                </a>
            
        
            
        
            
        
            
        

        <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>
    </section>

    <article class="print-container p-3">

        <section>
            <h1>Fix-employee-retention</h1>
            
        </section>

        <section class="pb-3">
            <div class="small pb-1">
                
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/tags"><i class="fas fa-fw fa-tags"></i></a>
    </div>
    <div class="d-inline-block">
        
        <a href="/tag/posts/1/" class="me-1">posts</a>
        
        <a href="/tag/technical/1/" class="me-1">technical</a>
        
        <a href="/tag/management/1/" class="me-1">management</a>
        
        <a href="/tag/hr/1/" class="me-1">HR</a>
        
    </div>
</div>

                
<div class="d-flex">
    <div class="d-inline-block me-1">
        <a href="/categories"><i class="far fa-fw fa-folder-open"></i></a>
    </div>
    <div class="d-inline-block">
        
        
        <a href="/category/hr/1/" class="me-1">
                
            HR
            
        </a>
        
        
        <a href="/category/employees/1/" class="me-1">
                
            employees
            
        </a>
        
        
        <a href="/category/main/sub/1/" class="me-1">
                
            main
                
             - sub
            
        </a>
        
        
        <a href="/category/wont-work-as-expected/1/" class="me-1">
                
            wont, work, as, expected
            
        </a>
        
    </div>
</div>

            </div>
            <div class="row row-cols-auto gx-3">
                <div class="col"><i class="far fa-fw fa-calendar-alt"></i>01 Feb 2020</div>
                <div class="col"><i class="far fa-fw fa-user"></i>BaHI</div>
                <div class="col"><i class="fas fa-fw fa-stopwatch"></i> 1 min reading time</div>
            </div>
        </section>

        <section class="pb-3">
            
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porttitor metus non nunc varius, nec fermentum magna sagittis. Ut libero mi, blandit at molestie at, sollicitudin quis magna. Integer quis erat rutrum, euismod augue eu, sodales neque. Nunc vel turpis semper, posuere metus ac, gravida sapien. Mauris at malesuada lorem. Suspendisse dui odio, facilisis ac tempor vitae, porta id ligula. Curabitur rutrum lorem at auctor dignissim. Phasellus nulla sapien, hendrerit at aliquet ac, elementum id massa. Aenean eget metus ullamcorper, convallis diam non, rutrum ligula. Morbi gravida mauris in augue rutrum, non porta lacus suscipit.</p>

        </section>

    </article>

    <section class="p-3 d-flex d-flex justify-content-between align-items-center">
        <section class="share-wrapper">
    <span class="share-label text-muted mr-1">Share:</span>
    <span class="share-icons">
        
               
        
            
                
                <a  href="https://www.linkedin.com/sharing/share-offsite/?url=/post/fix-employee-retention/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="LinkedIn"
                    target="_blank" rel="noopener"
                    aria-label="LinkedIn"
                    >
                    <i class="fa-fw fab fa-fw fa-linkedin"></i>
                </a>
            
        
            
        
            
                
                <a  href="https://twitter.com/intent/tweet?text=Fix-employee-retention&amp;url=/post/fix-employee-retention/"
                    data-toggle="tooltip"
                    data-placement="top"
                    title="Twitter"
                    target="_blank" rel="noopener"
                    aria-label="Twitter"
                    >
                    <i class="fa-fw fab fa-fw fa-twitter"></i>
                </a>
            
        
            
        
            
        
            
        

        <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i>
    </span>
</section>

<script>
    function copyLink(url) {

        if (!url || 0 === url.length)
            url = window.location.href;

        ClipboardCopy.copy(
            url,
            () => { alert("Link copied successfully!"); },
            (err) => { alert("Link copy failed! Error: ", err); },
        );
    }
</script>
        <div class="small">
            
<div class="license-wrapper">
    This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.
</div>

        </div>
    </section>

    <section class="p-3">
        
<div class="d-flex">
    <div class="post-navigation-button text-start me-auto">
        <a href="/post/hire-talents-easily/" title="Hire-talents-easily"><i class="fas fa-2x fa-chevron-left align-middle"></i>&nbsp;Previous</a>
    </div>
    
    <div class="post-navigation-button text-end ms-auto">
        <a href="/post/estimation-quick-recap/" title="Estimation - Quick recap">Next&nbsp;<i class="fas fa-2x fa-chevron-right align-middle"></i></a>
    </div>
    </div>
    </section>

    <hr/>

    <section class="p-3">
        
<!--
    Based on: Jekyll - Chirpy + extension to support CC

    Inserts DISQUS to the page.
    Also loads necessary scripts and sets disqus identifier to the given page URL.

    Usage (on the page / post layout):

        
-->
<div id="disqus">
    <p class="font-italic text-center text-muted small">
        Comments powered by <a href="https://disqus.com/">Disqus</a> - function requires cookie consent (see drawer at the bottom right corner)!
    </p>
</div>

<script src="/assets/js/disqusloader.min.js"></script>

<script>
    function loadDisqus() {
        var options = {
            scriptUrl: '//hidegh-github-io.disqus.com/embed.js',

            disqusConfig: function () {
                this.page.url = document.location.origin + '/post/fix-employee-retention/';
                this.page.identifier = '/post/fix-employee-retention/';
            }
        };

        disqusLoader('#disqus', options);
    }
</script>

    </section>


            </div>

            <aside class="sticky-container d-none d-xl-block small col-xl-3 p-0">
                

    <section class="sticky p-3 mb-3">
        
<div class="heading">
    <h2 class="d-inline">Recent posts</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        
<ul class="recent-posts">
    
    <li>
        <a href="/post/ddd-series-10-forbidden-location/">
            <span>DDD Series - 10 - Forbidden location</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-9-summary/">
            <span>DDD Series - 9 - Summary</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-8-bounded-context-at-help-to-tackle-complexity/">
            <span>DDD Series - 8 - Bounded context at help to tackle complexity</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-7-testing-is-easy-with-ddd/">
            <span>DDD Series - 7 - Testing is easy with DDD</span>
        </a>
    </li>
    
    <li>
        <a href="/post/ddd-series-6-the-lazy-way-towards-ddd-(using-orm)/">
            <span>DDD Series - 6 - The lazy way towards DDD (using ORM)</span>
        </a>
    </li>
    
</ul>


    </section>
    
    <section class="sticky p-3 mb-3 d-hide-if-empty">
        
<div class="heading">
    <h2 class="d-inline">Tag cloud</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

         
    <span style="font-size: 0.8em;">
        <a href="/tag/clean-code/1/">clean-code</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/ddd/1/">ddd</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/favicon/1/">favicon</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/getting-started/1/">getting started</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/google-analytics/1/">google analytics</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/hr/1/">HR</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/intro/1/">intro</a>
    </span>
 
    <span style="font-size: 1em;">
        <a href="/tag/management/1/">management</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/mytag/1/">myTag</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/outer-middle-inner/1/">outer - middle - inner</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/pageviews/1/">pageviews</a>
    </span>
 
    <span style="font-size: 1.8em;">
        <a href="/tag/posts/1/">posts</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/posts-technical-management-estimation-recap-this-is-a-single-big-tag-name!/1/">posts, technical, management, estimation, recap - this is a single big tag name!</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/programming/1/">programming</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/recap/1/">recap</a>
    </span>
 
    <span style="font-size: 1.3333333333333335em;">
        <a href="/tag/series/1/">series</a>
    </span>
 
    <span style="font-size: 1.6666666666666667em;">
        <a href="/tag/technical/1/">technical</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/typography/1/">typography</a>
    </span>
 
    <span style="font-size: 0.8em;">
        <a href="/tag/writing/1/">writing</a>
    </span>


    </section>

    <section class="sticky p-3 mb-3 d-hide-if-empty">
        
<div class="heading">
    <h2 class="d-inline">Related articles</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        <div class="text-nowrap overflow-hidden">
        

<ul class="related-posts">
    
    <li>
        
        <a href="/post/how-to-get-better-at-anything/">
            <span>How-to-get-better-at-anything</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/how-to-get-better-at-anything-pt3/">
            <span>How-to-get-better-at-anything - pt3</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/how-to-get-better-at-anything-pt2/">
            <span>How-to-get-better-at-anything - pt2</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/ddd-series-8-bounded-context-at-help-to-tackle-complexity/">
            <span>DDD Series - 8 - Bounded context at help to tackle complexity</span>
        </a>
    </li>
    
    <li>
        
        <a href="/post/clean-code-quick-recap/">
            <span>Clean code - Quick recap</span>
        </a>
    </li>
    
</ul>

        </div>
    </section>
    
    <section class="p-3 mb-3 d-hide-if-empty sticky">
        
<div class="heading">
    <h2 class="d-inline">Remove me</h2>
    <a class="sticky-link btn btn-sm btn-outline-primary float-end"><i class="fas fa-link"></i></a>
</div>

        <div class="text-nowrap overflow-hidden">
        

        </div>
    </section>


            </aside>

        </div>

        <div id="search-results-container" class="row pt-3 d-none">
            <div class="search-results col-12">
            </div>
        </div>

    </div>

    


        </main>

        
        

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous"></script>

<script>
    const scripts_config = {

        defaultCookies: function () {
            console.log('default cookies');

            // note: using anonymized IP
            if (typeof loadGA === 'function') loadGA(true);
        },

        enableCookies: function () {
            console.log('enabled cookies');

            if (typeof loadGA === 'function') loadGA(false);
            if (typeof loadDisqus === 'function') loadDisqus();
        },

        disableCookies: function () {
            console.log('disabled cookies');

            this.defaultCookies();
        },

        loadScripts: function (requireConsent, consentUrl) {
            if (requireConsent) {
                // scripts managed based on consent status
                this.initializeCookieConsent(consentUrl);
            } else {
                // all scripts enabled
                this.enableCookies();
            }
        },

        initializeCookieConsent: function (consentUrl) {

            const me = this;

            window.cookieconsent.initialise({
                "palette": {
                    "popup": {
                        "background": "#edeff5",
                        "text": "#838391"
                    },
                    "button": {
                        "background": "#4b81e8"
                    }
                },
                "position": "bottom-right",
                "type": "opt-in",
                "content": {
                    "message": "This website uses cookies to ensure you get the best experience here.",
                    "href": consentUrl
                },

                onInitialise: function (status) {
                    console.log(`cc - onInitialise, status: ${status}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    if (type == 'opt-in' && didConsent) {
                        me.enableCookies();
                    }
                    else if (type == 'opt-out' && !didConsent) {
                        me.disableCookies();
                    }
                    else {
                        me.defaultCookies();
                    }
                },

                onStatusChange: function (status, chosenBefore) {
                    console.log(`cc - onStatusChange, status: ${status}, chosenBefore: ${chosenBefore}`);

                    var type = this.options.type;
                    var didConsent = this.hasConsented();
                    if (type == 'opt-in' && didConsent) {
                        me.enableCookies();
                    }
                    if (type == 'opt-out' && !didConsent) {
                        me.disableCookies();
                    }
                },

                onRevokeChoice: function () {
                    // NOTE: this hook is called immediately after the revoke button is clicked and removes previous answers
                    console.log(`cc - onRevokeChoice`);

                    var type = this.options.type;
                    if (type == 'opt-in') {
                        me.disableCookies();

                        // NOTE: we need to reload page, so that we get rid of the loaded GA / Disqus scripts!
                        location.reload();
                    }
                    if (type == 'opt-out') {
                        me.enableCookies();
                    }
                },

                onPopupOpen: function () {
                    console.log(`cc - onPopupOpen`);
                },

                onPopupClose: function () {
                    console.log(`cc - onPopupClose`);
                }

            });

        }

    };

    const requireConsent = JSON.parse('true');
    const consentUrl = '/cookies.html';
    
    scripts_config.loadScripts(requireConsent, consentUrl);
</script>



        <script>

    /* uses:
    EJS.CO for templating
    LUNR for search
    HE for HTML encoding (at highlight fnc.)
    */
   
    class Debouncer {
        _timeoutId = undefined;
        _wait = 250;
        _callback;

        constructor(callback, wait) {
            this._wait = wait ? wait : this._wait;
            this._callback = callback;
        }

        next(...args) {
            this.cancel();
            this._timeoutId = window.setTimeout(() => {
            this._callback.apply(null, args);
            }, this._wait);
        }

        cancel() {
            window.clearTimeout(this._timeoutId);
        }
    }

    const blogSearch = {

        _searchIndexPath: '/search.json',
        _urlPrefix: '/',
        _debounceTime: 400,

        _searchingTemplate: `
<h2>
    <i class="text-secondary fas fa-spin fa-circle-notch"></i>
    <span class="text-secondary">Searching for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>
`,

        _resultTemplate: `
<h2>
    <span class="text-secondary">Search results for:</span>
    <span class="text-primary"><%= searchText %></span>
</h2>

<ul class="search-results">
<% searchResults.forEach((sr) => { %>
    <li>
        <div class="search-result-item position-relative border shadow">
            <h5><%- sr.ref.title %></h5>
            <p class="x-text-nowrap x-text-truncate"><%- sr.ref.summary %></p>
            <a href="<%- urlPrefix %><%- sr.ref.url %>" class="stretched-link"></a>
        </div>
    </li>
<% }); %>
</ul>        
`,

        _inputElements: [],
        _cancelElements: [],
        
        _updateInputs(value) {
            this._inputElements.forEach(el => el.value = value);
        },

        _setUpListeners(inputSelector, cancelSelector) {
            if (inputSelector) {
                this._inputElements = document.querySelectorAll(inputSelector);
                this._inputElements.forEach(el => el.addEventListener('keyup', evt => { if (evt.keyCode == 27) this._escapePressed(el); else this._inputValueChanged(el); } ));
            } else {
                this._inputElements = [];
            }

            if (cancelSelector) {
                this._cancelElements = document.querySelectorAll(cancelSelector);
            } else {
                this._cancelElements = [];
            }
        },

        _escapePressed(el) {
            this.clearSearch();
        },

        _inputValueChanged(el) {
            const value = el.value;
            this._updateInputs(value);
            this._debouncedSearch.next(value);
        },

        _resultContainerEls: [],
        _containersToHideEls: [],

        _setUpContainers(resultContainerSelector, containersToHideWhenResultSelector) {
            this._resultContainerEls = document.querySelectorAll(resultContainerSelector);
            this._containersToHideEls = document.querySelectorAll(containersToHideWhenResultSelector);
        },

        _showResults: false,
        _searching: false,
        _searchText: '',
        _searchResults: [],

        refreshUi() {
            const self = this;

            self._inputElements.forEach(el => el.value = self._searchText );

            const html = self._showResults
                ? self._searching
                    ? ejs.render(self._searchingTemplate, { searchText: self._searchText })
                    : ejs.render(self._resultTemplate, { urlPrefix: self._urlPrefix.replace(/\/+$/, ''), searchText: self._searchText, searchResults: self._searchResults })
                : '';

            self._resultContainerEls.forEach(el => { 
                // hide/show container
                self._showResults ? el.classList.remove("d-none") : el.classList.add("d-none")
                
                // find results element and set results
                const resultsEl = el.querySelector(".search-results");
                if (resultsEl) {
                    resultsEl.innerHTML = self._showResults ? html : "";
                }
            });

            self._containersToHideEls.forEach(el => self._showResults ? el.classList.add("d-none") : el.classList.remove("d-none"));          
        },

        clearSearch() {
            this._showResults = false;
            this._searchText = '';
            this._searchResults = [];
            this.refreshUi();
        },

        search(text) {

            const self = this;

            console.log('searching for: ', text);
            self._searchText = text;

            if (!text) {
                self.clearSearch();
                return;
            }

            this._searchResults = [];
            self._searching = true;
            self._showResults = true;
            this.refreshUi();

            const hasSpecial = self._lunrSpecial.some(special => text.includes(special));
            const pattern =  hasSpecial 
                ? text
                : text + "*";

            console.log('lunr pattern: ', pattern);
            const localResults = self._lunrEngine.search(pattern);

            // NOTE: just for tests...
            // console.log('total result', localResults)

            // NOTE: highlighting
            localResults.forEach(localResult => {
                // NOTE: hard. ref.
                const data = self._lunrSearchData.find(i => i.url == localResult.ref);

                const highlight = {};

                for (let term in localResult.matchData.metadata) {
                    for (let field in localResult.matchData.metadata[term]) {

                        const positions = localResult.matchData.metadata[term][field].position;

                        const fieldValue = data[field];
                        let fieldReadIndex = 0;

                        highlight[field] = "";

                        for (let position of positions) {

                            if (position[0] > fieldReadIndex)
                                highlight[field] += fieldValue.substring(fieldReadIndex, position[0]);

                            highlight[field] += ("{:::" + fieldValue.substring(position[0], position[0] + position[1]) + ":::}");

                            fieldReadIndex = position[0] + position[1];

                        }

                        highlight[field] += fieldValue.substring(fieldReadIndex);             

                    }

                }

                for (let key in highlight) {
                    let value = highlight[key];

                    const encode = false;
                    let encoded = encode
                        ? he.encode(value)
                        : value;

                    let highlighted = encoded.replace(/{:::/g, '<mark>').replace(/:::}/g, '</mark>');
                    highlight[key] = highlighted;
                }

                localResult.ref = Object.assign({}, data, highlight);
            });

            self._searchResults = localResults;

            // finally
            self._searching = false;
            self.refreshUi();
        },

        _lunrSpecial: "*+-:^~".split(''),
        _lunrSearchData: undefined,
        _lunrEngine: undefined,

        init(inputSelector, cancelSelector, resultContainerSelector, containersToHideWhenResultSelector) {

            console.log('initializing search', this);

            // set up result / hide elements
            this._setUpContainers(resultContainerSelector, containersToHideWhenResultSelector);

            // refresh
            this.refreshUi();

            fetch(this._searchIndexPath).then((response) => {
                response.json().then((raw) => {

                    // set up engine, store search data
                    this._lunrSearchData = raw;

                    this._lunrEngine = lunr(function () {
                        this.ref('url')
                        this.field('title')
                        this.field('date')
                        this.field('author')
                        this.field('summary')
                        this.field('text')

                        this.metadataWhitelist = ['position']

                        raw.forEach(function (doc) { this.add(doc) }, this)
                    });

                    // set up UI listeners
                    this._debouncedSearch = new Debouncer((args) => this.search(args), this._debounceTime);
                    this._setUpListeners(inputSelector, cancelSelector);

                    // refresh
                    this.refreshUi();
                });
            });

        }

    };

    // NOTE: search-results-container must have an additional element with a .search-results class
    blogSearch.init('.blog-search-input', '.blog-search-cancel', '#search-results-container', '#global-content-view');

</script>


    </body>

    <script src="/assets/js/d-hide-if-empty.js"></script>
    <script src="/assets/js/sticky.js"></script>
</html>
